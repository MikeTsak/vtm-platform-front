// src/data/retuals.js
// Unified data DB for Blood Sorcery Rituals and Oblivion Ceremonies.
// Style: similar to disciplines.js (ids, levels, consistent fields).
// Defaults:
// - Blood Sorcery: Cost 1 Rouse, Time 5 min/level, Dice = Int + Blood Sorcery, Diff = (Level+1)
// - Oblivion Ceremonies: Cost 1 Rouse, Time 5 min/level, Dice = Resolve + Oblivion, Diff = (Level+1)

export const RITUALS = {
  blood_sorcery: {
    meta: {
      discipline: 'Blood Sorcery',
      defaults: {
        cost: '1 Rouse',
        time: '5 minutes per level',
        dice_pool: 'Intelligence + Blood Sorcery',
        difficulty: 'Ritual Level + 1',
        beneficiary: 'Self (unless stated otherwise)',
      },
      notes:
        'Learning a new ritual typically takes at least (level²) weeks; good teachers/grimoires may reduce this. New rituals may be created via extended tests over in-game months.',
    },
    levels: {
      1: [
        {
          id: 'astromancy',
          name: 'Astromancy',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Discern Skills, Desires, and Convictions about a subject.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Knowing the target’s Birth or Embrace date grants +1 die (does not stack).',
          source: 'Blood Sigils p.59',
        },
        {
          id: 'bind_the_accusing_tongue',
          name: 'Bind the Accusing Tongue',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Prevents a target from communicating negative things about the caster.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Target can break free by Composure + Resolve.',
          source: 'Blood Sigils p.60',
        },
        {
          id: 'blood_walk',
          name: 'Blood Walk',
          origin: 'None',
          cost: '1 Rouse (target also Rouse)',
          effect: 'Learn a character’s generation, name, and sire.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Requires a Rouse Check from the subject.',
          source: 'Corebook p.276',
        },
        {
          id: 'clinging_of_the_insect',
          name: 'Clinging of the Insect',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Cling to walls/ceilings (requires both hands and feet).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.276',
        },
        {
          id: 'craft_bloodstone',
          name: 'Craft Bloodstone',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Create a tracking stone bound to the caster.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Maintain up to Resolve stones.',
          source: 'Corebook p.276',
        },
        {
          id: 'wake_with_evenings_freshness',
          name: 'Wake with Evening’s Freshness',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Awaken at signs of danger during day sleep.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Roll only when true danger appears.',
          source: 'Corebook p.276',
        },
        {
          id: 'ward_against_ghouls',
          name: 'Ward Against Ghouls',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Protect against ghouls (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Uses standard Ward rules.',
          source: 'Corebook p.277',
        },
      ],
      2: [
        {
          id: 'communicate_with_kindred_sire',
          name: 'Communicate with Kindred Sire',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Long-distance telepathic link between Sire and Childe.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Major disturbance on either side breaks the link.',
          source: 'Corebook p.277',
        },
        {
          id: 'eyes_of_babel',
          name: 'Eyes of Babel',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'After consuming victim’s eyes & tongue, read/speak any of their languages.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'May incur Stains.',
          source: 'Corebook p.277',
        },
        {
          id: 'illuminate_trail_of_prey',
          name: 'Illuminate Trail of Prey',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Follow the trail of a specific person.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Must know the victim’s face.',
          source: 'Corebook p.277',
        },
        {
          id: 'truth_of_blood',
          name: 'Truth of Blood',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Discern truth from lies.',
          dice_pool: 'Resolve + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Target resists with Composure + Occult; cannot pierce memory-wipes.',
          source: 'Corebook p.277',
        },
        {
          id: 'ward_against_spirits',
          name: 'Ward against Spirits',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Protect against spirits (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Uses standard Ward rules.',
          source: 'Corebook p.277',
        },
        {
          id: 'warding_circle_against_ghouls',
          name: 'Warding Circle against Ghouls',
          origin: 'None',
          cost: '3 Rouse',
          effect: 'Circle ward vs ghouls (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.278',
        },
      ],
      3: [
        {
          id: 'dagons_call',
          name: 'Dagon’s Call',
          origin: 'None',
          cost: '1 Rouse (+ more for repeats)',
          effect: 'Rupture a victim’s blood vessels from afar.',
          dice_pool: 'Resolve + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'May repeat up to 2×, each costs +1 Rouse. Opposed by Stamina + Resolve.',
          source: 'Corebook p.278',
        },
        {
          id: 'deflection_of_wooden_doom',
          name: 'Deflection of Wooden Doom',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Protect against staking.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Roll when actually staked.',
          source: 'Corebook p.278',
        },
        {
          id: 'essence_of_air',
          name: 'Essence of Air',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Flight.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Camarilla dislikes due to Masquerade risk.',
          source: 'Corebook p.278',
        },
        {
          id: 'firewalker',
          name: 'Firewalker',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Grant fire resistance to self and comrades.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'If cast on others, all fingertip offerings must be the caster’s.',
          source: 'Corebook p.279',
        },
        {
          id: 'ward_against_lupines',
          name: 'Ward against Lupines',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Protect against werewolves (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.279',
        },
        {
          id: 'warding_circle_against_spirits',
          name: 'Warding Circle against Spirits',
          origin: 'None',
          cost: '3 Rouse',
          effect: 'Circle ward vs spirits (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.279',
        },
      ],
      4: [
        {
          id: 'defense_of_the_sacred_haven',
          name: 'Defense of the Sacred Haven',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Shroud a haven from the sun with mystical darkness.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Roll at sunrise.',
          source: 'Corebook p.279',
        },
        {
          id: 'eyes_of_the_nighthawk',
          name: 'Eyes of the Nighthawk',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Possess a carnivorous bird; use most non-physical Disciplines Through it.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.279',
        },
        {
          id: 'incorporeal_passage',
          name: 'Incorporeal Passage',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Become ghost-like; interact only via speech/sight.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.280',
        },
        {
          id: 'ward_against_cainites',
          name: 'Ward against Cainites',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Protect against Kindred (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Examining Kindred may read caster’s name with an opposed test.',
          source: 'Corebook p.280',
        },
        {
          id: 'warding_circle_against_lupines',
          name: 'Warding Circle against Lupines',
          origin: 'None',
          cost: '3 Rouse',
          effect: 'Circle ward vs werewolves (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.280',
        },
      ],
      5: [
        {
          id: 'antebrachia_ignium',
          name: 'Antebrachia Ignium (Errata)',
          origin: 'Church of Caine',
          cost: '1 Rouse',
          effect: 'Set your arms ablaze; limited fire resistance.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Resistance applies only to the arms.',
          source: 'Cults of the Blood Gods p.67; Players Guide p.102',
        },
        {
          id: 'escape_to_true_sanctuary',
          name: 'Escape to True Sanctuary',
          origin: 'None',
          cost: '12 Rouse (total)',
          effect: 'Create a one-way portal between two circles (only one pair active per caster).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.280',
        },
        {
          id: 'heart_of_stone',
          name: 'Heart of Stone',
          origin: 'None',
          cost: '1 Rouse',
          effect: 'Turn heart to stone (prevents staking) but causes emotional detachment.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Cannot use Presence; bonus vs Presence used on you.',
          source: 'Corebook p.281',
        },
        {
          id: 'shaft_of_belated_dissolution',
          name: 'Shaft of Belated Dissolution',
          origin: 'None',
          cost: '2 Rouse',
          effect: 'Stake seeks the heart; may cause final death if it finds it.',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: 'Even on a miss, a splinter may continue toward the heart.',
          source: 'Corebook p.281',
        },
        {
          id: 'warding_circle_against_cainites',
          name: 'Warding Circle against Cainites',
          origin: 'None',
          cost: '3 Rouse',
          effect: 'Circle ward vs Kindred (Ward rules).',
          dice_pool: 'Intelligence + Blood Sorcery',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Corebook p.282',
        },
      ],
    },
  },

  oblivion: {
    meta: {
      discipline: 'Oblivion (Ceremonies)',
      defaults: {
        cost: '1 Rouse',
        time: '5 minutes per level',
        dice_pool: 'Resolve + Oblivion',
        difficulty: 'Ceremony Level + 1',
        beneficiary: 'Self (unless stated otherwise)',
      },
      notes:
        'Ceremonies often require specific components. Learning a ceremony typically takes at least (level²) weeks; can be reduced with good instruction or lore.',
    },
    levels: {
      1: [
        {
          id: 'gift_of_false_life',
          name: 'Gift of False Life',
          prereq: 'Ashes to Ashes',
          cost: '1 Rouse',
          effect: 'Raise a corpse (or group) to perform simple, repetitive tasks.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Mindless; do not defend themselves; decay as normal.',
          source: 'Cults of the Blood Gods p.208; Players Guide p.92',
        },
        {
          id: 'knowing_stone',
          name: 'Knowing Stone',
          prereq: 'Ashes to Ashes; Binding Fetter (Errata)',
          cost: '1 Rouse',
          effect: 'Identify locations/existence of specific ghosts.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Must know the ghost’s name.',
          source: 'Fall of London p.264 (Errata)',
        },
        {
          id: 'summon_spirit',
          name: 'Summon Spirit',
          prereq: 'Binding Fetter',
          cost: '1 Rouse',
          effect: 'Summon a wraith from the Underworld; fades at end of scene unless compelled.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Pair with Compel Spirit to keep them.',
          source: 'Cults of the Blood Gods p.209; Players Guide p.92',
        },
        {
          id: 'travelers_call',
          name: "Traveler's Call",
          prereq: 'Oblivion Sight',
          cost: '1 Rouse',
          effect: 'Summon another Shalimite.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Target may ignore (-2 to concentration pools for a scene). Cult of Shalim.',
          source: 'Cults of the Blood Gods p.93',
        },
      ],
      2: [
        {
          id: 'ashen_relic',
          name: 'Ashen Relic',
          prereq: "Ashes to Ashes or Oblivion's Sight",
          cost: '1 Rouse',
          effect: "Preserve a Kindred's body.",
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Greater margin preserves more.',
          source: 'Book of Nod Apocrypha p.35',
        },
        {
          id: 'awaken_the_homuncular_servant',
          name: 'Awaken the Homuncular Servant',
          prereq: 'Where the Shroud Thins',
          cost: '1 Rouse',
          effect: 'Create spies/stalkers from parts or small animals.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Climbs/hides; cannot speak; telepathic image pings only.',
          source: 'Cults of the Blood Gods p.209; Players Guide p.93',
        },
        {
          id: 'blinding_the_alloy_eye',
          name: 'Blinding the Alloy Eye',
          prereq: 'Shadow Cast',
          cost: '1 Rouse',
          effect: 'Cameras cannot perceive the user clearly.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Roll when effect is triggered. Sabbat-linked.',
          source: 'Sabbat p.52',
        },
        {
          id: 'compel_spirit',
          name: 'Compel Spirit',
          prereq: 'Where the Shroud Thins',
          cost: '1 Rouse',
          effect: "Bend a wraith to the vampire's will.",
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Opposed by wraith’s Resolve + Composure/Willpower.',
          source: 'Cults of the Blood Gods p.210; Players Guide p.94',
        },
        {
          id: 'maw_of_ahriman',
          name: 'Maw of Ahriman',
          prereq: '—',
          cost: '1 Rouse',
          effect: 'Open a portal to the Abyss (often in the mouth).',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'User cannot speak until cancelled or next sunrise.',
          source: 'Blood Stained Love p.152',
        },
      ],
      3: [
        {
          id: 'fortezza_sindonica',
          name: 'Fortezza Sindonica',
          prereq: 'Where the Shroud Thins',
          cost: '3 Rouse',
          effect: 'Create a barrier that harms wraiths.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Roll when a wraith attempts to pass. Hecata-linked.',
          source: 'Trails of Ash and Bone p.173',
        },
        {
          id: 'harrowhaunt',
          name: 'Harrowhaunt',
          prereq: 'Aura of Decay',
          cost: '1 Rouse (possible Stains)',
          effect: 'Keep unwanted visitors from a haven.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Vampires may enter but must check fear frenzy each turn. Sabbat-linked.',
          source: 'Sabbat p.51',
        },
        {
          id: 'host_spirit',
          name: 'Host Spirit',
          prereq: 'Aura of Decay',
          cost: '1 Rouse',
          effect: 'Open the body to possession by a ghost.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: '+2 Physical dice, +2 Health; may use wraith skills (ST discretion). Errata.',
          source: 'Cults of the Blood Gods p.211; Players Guide p.94',
        },
        {
          id: 'knit_the_veil',
          name: 'Knit the Veil',
          prereq: 'Where the Shroud Thins',
          cost: '1 Rouse',
          effect: 'Make a shroud impenetrable.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Lasts nights equal to Oblivion rating when undisturbed.',
          source: 'Trails of Ash and Bone p.174',
        },
        {
          id: 'name_of_the_father',
          name: 'Name of the Father',
          prereq: 'Shadow Perspective',
          cost: '1 Rouse',
          effect: 'Strike a mind with the void; paralyze.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Victim may spend Willpower equal to turns remaining to free themselves. Cult of Shalim.',
          source: 'Cults of the Blood Gods p.94',
        },
        {
          id: 'shallow_slumber',
          name: 'Shallow Slumber',
          prereq: 'Passion Feast or Touch of Oblivion',
          cost: '1 Rouse',
          effect: 'Reduce time spent in torpor.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: '',
          source: 'Gehenna War p.50',
        },
        {
          id: 'shambling_hordes',
          name: 'Shambling Hordes',
          prereq: 'Aura of Decay',
          cost: '1 Rouse (possible Stains)',
          effect: 'Raise a group of aggressive walking dead.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Without commands, they attack everyone except their master.',
          source: 'Cults of the Blood Gods p.212; Players Guide p.95',
        },
        {
          id: 'wisdom_of_the_dead',
          name: 'Wisdom of the Dead',
          prereq: "Where the Shroud Thins or Oblivion's Sight",
          cost: '1 Rouse',
          effect: 'Gain information from a corpse skull/head.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'If carried afterward, +2 dice for the rest of the night.',
          source: 'Book of Nod Apocrypha p.35',
        },
      ],
      4: [
        {
          id: 'befoul_vessel',
          name: 'Befoul Vessel',
          prereq: 'Necrotic Plague',
          cost: '1 Rouse',
          effect: "Make a mortal's blood poisonous to vampires.",
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Leaves no trace besides mortal’s death next night; Sabbat-linked.',
          source: 'Sabbat p.52',
        },
        {
          id: 'bind_the_spirit',
          name: 'Bind the Spirit',
          prereq: 'Necrotic Plague',
          cost: '1 Rouse (possible Stains)',
          effect: 'Bind a wraith to a location or person.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Bound wraiths gain spectre-like powers.',
          source: 'Cults of the Blood Gods p.212; Players Guide p.96',
        },
        {
          id: 'death_rattle',
          name: 'Death Rattle',
          prereq: 'Fatal Precognition',
          cost: '1 Rouse',
          effect: "Inflict a wraith's death-sensory experience on a target.",
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Victim contests with Composure + Resolve.',
          source: 'Trails of Ash and Bone p.174',
        },
        {
          id: 'split_the_veil',
          name: 'Split the Veil (Errata)',
          prereq: 'Necrotic Plague',
          cost: '1 Rouse (possible Stains)',
          effect: 'Tear the shroud, allowing wraiths to enter.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Reduces veil density; returns to frayed after session ends. Errata.',
          source: 'Cults of the Blood Gods p.213; Players Guide p.96',
        },
      ],
      5: [
        {
          id: 'ex_nihilo',
          name: 'Ex Nihilo',
          prereq: 'Withering Spirit',
          cost: '3 Rouse + 1 Willpower',
          effect: 'Enter the Shadowlands.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Shadowlands have distinct rules/risks.',
          source: 'Cults of the Blood Gods p.213',
        },
        {
          id: 'lazarene_blessing',
          name: 'Lazarene Blessing',
          prereq: 'Skuld Fulfilled',
          cost: '1 Rouse (possible Stains)',
          effect: 'Bring a fresh corpse back to life.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Lasts until death again or wraith is exorcised.',
          source: 'Cults of the Blood Gods p.214; Players Guide p.96',
        },
        {
          id: 'pit_of_contemplation',
          name: 'Pit of Contemplation',
          prereq: 'Tenebrous Avatar',
          cost: '1 Rouse (possible Stains)',
          effect: 'Cast an enemy into Oblivion itself.',
          dice_pool: 'Resolve + Oblivion',
          difficulty: 'Level + 1',
          notes: 'Mortals are instantly killed. Cult of Shalim.',
          source: 'Cults of the Blood Gods p.94',
        },
      ],
    },
  },
};

// -------- Convenience finders (optional) --------
export function findRitualById(id) {
  // Searches both Blood Sorcery and Oblivion
  const pools = [
    RITUALS.blood_sorcery.levels,
    RITUALS.oblivion.levels,
  ];
  for (const levels of pools) {
    for (const lvl of Object.keys(levels)) {
      const hit = levels[lvl].find(r => r.id === id);
      if (hit) return { ...hit, level: Number(lvl) };
    }
  }
  return null;
}

export function listRitualsByLevel(kind = 'blood_sorcery', level = 0) {
  const block = RITUALS[kind]?.levels;
  if (!block) return [];
  if (level === 0) {
    return Object.entries(block)
      .flatMap(([lvl, arr]) => arr.map(r => ({ ...r, level: Number(lvl) })));
  }
  return (block[level] || []).map(r => ({ ...r, level }));
}
