# ----------------------------------------
# ‚úÖ React Router SPA + Node API + Strict Privacy
# ----------------------------------------

RewriteEngine On
RewriteBase /

# 1Ô∏è‚É£  Serve index.html normally if requested explicitly
RewriteRule ^index\.html$ - [L]

# 2Ô∏è‚É£  Don't touch API routes ‚Äî let Node/Express handle them
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule . - [L]

# 3Ô∏è‚É£  If the request matches an existing file or folder, serve it
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule . - [L]

# 4Ô∏è‚É£  Otherwise, hand everything else to the SPA
RewriteRule . /index.html [L]

# ----------------------------------------
# üß†  Caching rules
# ----------------------------------------

# üóÇÔ∏è  NEVER cache the SPA shell or logic (Forces fresh session/code)
<FilesMatch "^index\.html$|\.(js|css|json)$">
  Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
  Header set Pragma "no-cache"
  Header set Expires "0"
</FilesMatch>

# üñºÔ∏è  Cache images for 6 months (15,552,000 seconds)
<FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|webp)$">
  Header set Cache-Control "public, max-age=15552000"
</FilesMatch>

# üíæ  Cache fonts for 1 year
<FilesMatch "\.(woff|woff2|ttf|eot)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# üßæ  Gzip/Brotli if your host supports it
AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json