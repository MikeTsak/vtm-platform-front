# ----------------------------------------
# ‚úÖ React Router SPA + Node API + Strict Privacy
# ----------------------------------------

RewriteEngine On
RewriteBase /

# ----------------------------------------
# üîß MIME Type Configuration (Fix MIME errors)
# ----------------------------------------

# Ensure JavaScript files are served with the correct MIME type
AddType application/javascript .js
AddType text/javascript .js
AddType application/x-javascript .js

# Ensure CSS files are served with the correct MIME type
AddType text/css .css

# Ensure JSON files are served with the correct MIME type
AddType application/json .json

# Ensure manifest is served with the correct MIME type
AddType application/manifest+json .webmanifest
<FilesMatch "^manifest\.json$">
  Header set Content-Type "application/manifest+json"
</FilesMatch>

# Ensure images are served with the correct MIME type
AddType image/png .png
AddType image/jpeg .jpg .jpeg
AddType image/gif .gif
AddType image/svg+xml .svg
AddType image/x-icon .ico
AddType image/webp .webp

# Ensure fonts are served with the correct MIME type
AddType font/woff .woff
AddType font/woff2 .woff2
AddType font/ttf .ttf
AddType font/eot .eot

# ----------------------------------------
# üîÄ Routing Configuration
# ----------------------------------------

# 1Ô∏è‚É£  Serve index.html normally if requested explicitly
RewriteRule ^index\.html$ - [L]

# 2Ô∏è‚É£  Don't touch API routes ‚Äî let Node/Express handle them
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule . - [L]

# 3Ô∏è‚É£  If the request matches an existing file or folder, serve it
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule . - [L]

# 4Ô∏è‚É£  Otherwise, hand everything else to the SPA
RewriteRule . /index.html [L]

# ----------------------------------------
# üß†  Caching rules
# ----------------------------------------

# üóÇÔ∏è  NEVER cache the SPA shell or logic (Forces fresh session/code)
<FilesMatch "^index\.html$|\.(js|css|json)$">
  Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
  Header set Pragma "no-cache"
  Header set Expires "0"
</FilesMatch>

# üñºÔ∏è  Cache images for 6 months (15,552,000 seconds)
<FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|webp)$">
  Header set Cache-Control "public, max-age=15552000"
</FilesMatch>

# üíæ  Cache fonts for 1 year
<FilesMatch "\.(woff|woff2|ttf|eot)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# üßæ  Gzip/Brotli compression
AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
